program main; 
uses crt, get_key;

const
    MATRIX_WIDTH = 36;
    MATRIX_HEIGHT = 34;
    MATRIX_BORDER_LEFT = 2;
    MATRIX_BORDER_TOP = 3;
    FIGURE_COUNT = 3;
    FIGURE_BG = '#';

type
    gameMatrixT = array [1..MATRIX_WIDTH + MATRIX_BORDER_LEFT,
        1..MATRIX_HEIGHT + MATRIX_BORDER_TOP] of char;

    gameSettings = record
        matrix: gameMatrixT;
    end;

    figureTypeNumberT = 1..FIGURE_COUNT;
    figureSizeT = record
        width, height: integer;
    end;
    figureT = record
        ftype: figureTypeNumberT;
        size: figureSizeT;
    end;

procedure DrawGameMatrix(var gameMatrix: gameMatrixT);
var
    x, y: integer;
begin
    for x := 1 to MATRIX_WIDTH do
    begin
        for y := 1 to MATRIX_HEIGHT do
        begin
            if (x > MATRIX_BORDER_LEFT) and (y > MATRIX_BORDER_TOP) then
            begin
                gameMatrix[x][y] := '0';
            end
        end
    end;

    for x := 1 to MATRIX_WIDTH do
    begin
        for y := 1 to MATRIX_HEIGHT do
        begin
            if (x > MATRIX_BORDER_LEFT) and (y > MATRIX_BORDER_TOP) then
                write(gameMatrix[x][y])
            else
                write(' ');
        end;
        writeln
    end;
    writeln
end;

procedure DrawChar(var gameMatrix: gameMatrixT; x, y: integer; ch: char);
var
    localX, localY: integer;
begin
    localX := x + MATRIX_BORDER_LEFT;
    localY := y + MATRIX_BORDER_TOP;

    {
    GotoXY(1, 1);
    write('gm: ',gameMatrix[localX, localY]);
    }

    gameMatrix[localX, localY] := ch;
    GotoXY(localX, localY);
    write(ch)
end;

procedure DrawCheckMatrix(
    var fig: figureT;
    var gameMatrix: gameMatrixT;
    x, y: integer
);
begin
    GotoXY(1, 2);
    write('x: ', x, '  ');
    write('y: ', y, '  ');

    {
    write('gm: ', gameMatrix[x, y+fig.size.height], '    ');
    }
end;

procedure DrawFigure(
    var fig: figureT;
    var gameMatrix: gameMatrixT;
    x, y: integer;
    ch: char
);
var
    i, j: integer;
begin
    for i := 1 to fig.size.height do
    begin
        for j := 1 to fig.size.width do
        begin
            case fig.ftype of
                1:
                begin
                    if i > 2 then
                    begin
                        if j > 6 then
                        begin
                            DrawCheckMatrix(fig, gameMatrix, x+j-1, y+i);
                            DrawChar(gameMatrix, x+j-1, y+i-1, ch)
                        end
                    end
                    else    
                        DrawChar(gameMatrix, x+j-1, y+i-1, ch)
                end;
                2:
                begin
                    if i <= 2 then
                    begin
                        if (j > 3) and (j < 7) then
                            DrawChar(gameMatrix, x+j-1, y+i-1, ch)
                    end
                    else    
                        DrawChar(gameMatrix, x+j-1, y+i-1, ch)
                end;
                3:
                begin
                    if i <= 2 then
                    begin
                        DrawChar(gameMatrix, x+j-1, y+i-1, ch)
                    end
                    else    
                    begin
                        if j < 4 then
                            DrawChar(gameMatrix, x+j-1, y+i-1, ch)
                    end
                end;
            {end case}
            end;

        {end for j }
        end
    {end for i }
    end
end;

var
    fig, fig2: figureT;
    gs: gameSettings;
    keyCode: integer;
    x, y, i: integer;
    xMove, yMove: integer;
begin
    clrscr;
    
    xMove := 0;
    yMove := 0;
    DrawGameMatrix(gs.matrix);

    fig.ftype := 1;
    fig.size.width := 9;
    fig.size.height := 6;

    fig2.ftype := 3;
    fig2.size.width := 6;
    fig2.size.height := 6;

    while true do
    begin
        GotoXY(1, 1);
        write('xMove: ', xMove, '  ');
        write('yMove: ', yMove);

        DrawFigure(fig, gs.matrix,
            xMove+MATRIX_BORDER_LEFT, yMove, FIGURE_BG);
        delay(150);
        DrawFigure(fig, gs.matrix, xMove+MATRIX_BORDER_LEFT, yMove, '0');

        DrawFigure(fig2, gs.matrix, 5, 20, FIGURE_BG);

        if KeyPressed then
        begin
            GetKey(keyCode);
            case keyCode of
                122: { z }
                begin
                end;
                120: { x }
                begin

                end;
                -72: { up }
                begin
                    if yMove > 0 then
                        yMove := yMove-1;
                end;
                -80: { down }
                begin
                    if yMove < (MATRIX_HEIGHT - MATRIX_BORDER_TOP-3) then
                    begin
                        yMove := yMove+1
                    end
                end;
                -75: { left }
                begin
                    if xMove+MATRIX_BORDER_LEFT > 2 then 
                        xMove := xMove-1;
                end;
                -77: { right }
                begin
                    if xMove < (MATRIX_WIDTH -
                        fig.size.width - MATRIX_BORDER_LEFT-3) then
                    begin
                        xMove := xMove+1
                    end
                end;
                32: 
                begin
                    GotoXY(1, 1);
                    clrscr;
                    halt(1)
                end;
                27: 
                begin
                    GotoXY(1, 1);
                    clrscr;
                    halt(1)
                end
            end
        end;
    end
end.
